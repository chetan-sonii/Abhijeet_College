{# templates/admin/courses.html - merge with your existing courses template #}
{% extends "admin/base.html" %}

{% block admin_content %}
<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Courses</h2>
    <div><button id="course-create-btn" class="btn btn-primary btn-sm">Add course</button></div>
  </div>

  <div class="card">
    <div class="card-body p-0">
      <table class="table mb-0">
        <thead><tr><th>ID</th><th>Title</th><th>Code</th><th>Department</th><th>Credits</th><th class="text-end">Actions</th></tr></thead>
        <tbody id="courses-body">
          {% for c in courses %}
          <tr data-cid="{{ c.id }}" data-dept-id="{{ c.department_id or '' }}">
            <td>{{ c.id }}</td>
            <td>{{ c.title }}</td>
            <td>{{ c.code or '—' }}</td>
            <td>{{ c.department.name if c.department else '—' }}</td>
            <td>{{ c.credits or '—' }}</td>
            <td class="text-end">
              <button class="btn btn-sm btn-outline-primary edit-course" data-id="{{ c.id }}" data-dept-id="{{ c.department_id or '' }}">Edit</button>
              <button class="btn btn-sm btn-outline-danger delete-course" data-id="{{ c.id }}">Delete</button>
            </td>
          </tr>
          {% else %}
          <tr><td colspan="6" class="text-center small text-muted">No courses yet</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- modal create/edit -->
<div class="modal fade" id="courseModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <form id="course-form" class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Course</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">
          <input type="hidden" name="id" id="course-id">
          <div class="mb-3"><label class="form-label">Title</label><input name="title" id="course-title" class="form-control" required></div>
          <div class="mb-3"><label class="form-label">Code</label><input name="code" id="course-code" class="form-control" required></div>
          <div class="mb-3"><label class="form-label">Department</label>
            <select id="course-dept" name="department_id" class="form-select">
              <option value="">-- none --</option>
              {% for d in departments %}
                <option value="{{ d.id }}">{{ d.name }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="mb-3"><label class="form-label">Credits</label><input name="credits" id="course-credits" class="form-control" type="number" step="1" min="0"></div>
          <div class="mb-3"><label class="form-label">Description</label><textarea id="course-desc" name="description" class="form-control" rows="4"></textarea></div>

          <!-- Fee structures for this department -->
          <hr>
          <div id="dept-fee-section" style="display:none">
            <h6>Department fees</h6>
            <div id="dept-fees-list" class="mb-3 small text-muted">Loading…</div>

            <div class="mb-3">
              <label class="form-label">Add fee for this department</label>
              <div class="row g-2">
                <div class="col-sm-6">
                  <input id="new-fee-name" class="form-control" placeholder="Fee name (tuition, etc.)">
                </div>
                <div class="col-sm-3">
                  <input id="new-fee-amount" class="form-control" placeholder="Amount" type="number" step="0.01">
                </div>
                <div class="col-sm-3">
                  <button id="add-fee-btn" type="button" class="btn btn-outline-primary w-100">Add fee</button>
                </div>
              </div>
            </div>
          </div>
          <!-- end fee section -->

        </div>
        <div class="modal-footer"><button type="submit" class="btn btn-primary">Save</button><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button></div>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block page_js %}
<script src="{{ url_for('static', filename='js/admin/courses.js') }}"></script>
{% endblock %}
